<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Esoteric Chart â€¢ True Geocentric Mode</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script src="https://unpkg.com/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://unpkg.com/three@0.134.0/examples/js/renderers/CSS2DRenderer.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { margin:0; overflow:hidden; background:#0a0a0f; font-family:system-ui,sans-serif; }
  #viewer { position:absolute; inset:0; }
  #sidebar { position:absolute; left:0; top:0; bottom:0; width:360px; background:rgba(15,15,30,0.94); backdrop-filter:blur(12px); border-right:1px solid #333; overflow-y:auto; z-index:10; padding:24px; }
  .label { pointer-events:none; font-weight:bold; text-shadow:0 0 8px #000, 0 0 12px #000; white-space:nowrap; font-size:21px; color:#f0f0ff; }
  button.on { background-color:#6366f1 !important; color:white; }
  button.off { background-color:#4b5563 !important; color:white; }
  #toggle-view { transition: all 0.3s; }
  #toggle-view.heliocentric { background: linear-gradient(to right, #6366f1, #a855f7); }
  #toggle-view.geocentric   { background: linear-gradient(to right, #10b981, #34d399); }
</style>
</head>
<body class="text-gray-200">

<div id="sidebar">
  <h1 class="text-3xl font-bold mb-1 text-center">Esoteric 3D</h1>
  <p class="text-gray-400 text-center mb-4">Heliocentric â†” Geocentric</p>

  <button id="toggle-view" class="w-full py-4 px-4 rounded font-medium text-lg font-bold heliocentric">
    Switch to Geocentric
  </button>

  <div class="space-y-3 mt-6">
    <button id="toggle-labels" class="w-full py-3 px-4 rounded font-medium bg-indigo-700/80 hover:bg-indigo-600 transition on">Labels: ON</button>
    <button id="toggle-orbits" class="w-full py-3 px-4 rounded font-medium bg-violet-700/80 hover:bg-violet-600 transition on">Orbits: ON</button>
    <button id="toggle-lines" class="w-full py-3 px-4 rounded font-medium bg-amber-700/80 hover:bg-amber-600 transition on">Sight Lines: ON</button>
    <button id="toggle-zodiac" class="w-full py-3 px-4 rounded font-medium bg-teal-700/80 hover:bg-teal-600 transition on">Zodiac: ON</button>
    <button id="toggle-stars" class="w-full py-3 px-4 rounded font-medium bg-purple-700/80 hover:bg-purple-600 transition on">Stars: ON</button>
  </div>

  <div class="mt-8">
    <label class="block text-gray-400 text-sm mb-2">Speed (Earth days/sec)</label>
    <div class="flex gap-2 flex-wrap">
      <button onclick="setSpeed(0.2)" class="speed-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600">0.2Ã—</button>
      <button onclick="setSpeed(1)" class="speed-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600 on">1Ã—</button>
      <button onclick="setSpeed(500)" class="speed-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600">500Ã—</button>
      <button onclick="setSpeed(5000)" class="speed-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600">5kÃ—</button>
    </div>
  </div>

  <button id="pause-btn" onclick="togglePause()" class="w-full mt-6 py-3 px-4 rounded font-medium bg-emerald-700 hover:bg-emerald-600">Pause</button>
  <button onclick="resetView()" class="w-full mt-3 py-3 px-4 rounded font-medium bg-gray-700 hover:bg-gray-600">Reset View</button>
</div>

<div id="viewer"></div>

<script>
// Real inclinations (degrees)
const inclinations = { Mercury:7.005, Venus:3.395, Earth:0, Mars:1.850, Jupiter:1.304, Saturn:2.488, Uranus:0.773, Neptune:1.770 };

const planetData = [
  {name:"Sun",     symbol:"â˜‰", radius:0,    period:0,     size:26,  color:0xffee88, initial:0},
  {name:"Mercury", symbol:"â˜¿", radius:65,   period:88,    size:7,   color:0xbbbbbb, initial:4.85},
  {name:"Venus",   symbol:"â™€", radius:98,   period:225,   size:10,  color:0xffccaa, initial:5.35},
  {name:"Earth",   symbol:"ðŸœ¨", radius:135,  period:365.25,size:11,  tex:"https://upload.wikimedia.org/wikipedia/commons/c/c3/Solarsystemscope_texture_2k_earth_daymap.jpg", initial:0.35},
  {name:"Mars",    symbol:"â™‚", radius:175,  period:687,   size:8.5, color:0xff5555, initial:0.95},
  {name:"Jupiter", symbol:"â™ƒ", radius:260,  period:4333,  size:18,  color:0xffaa33, initial:1.65},
  {name:"Saturn",  symbol:"â™„", radius:320,  period:10759, size:15,  color:0xeeeeee, initial:3.45},
  {name:"Uranus",  symbol:"â›¢", radius:380,  period:30687, size:12,  color:0x88ffff, initial:5.10},
  {name:"Neptune", symbol:"â™†", radius:430,  period:60190, size:12,  color:0x7777ff, initial:5.75}
];

const signs = ["â™ˆ Aries","â™‰ Taurus","â™Š Gemini","â™‹ Cancer","â™Œ Leo","â™ Virgo","â™Ž Libra","â™ Scorpio","â™ Sagittarius","â™‘ Capricorn","â™’ Aquarius","â™“ Pisces"];

let scene, camera, renderer, labelRenderer, controls;
let planets = [], moon, zodiacGroup, orbits = [], earthLines = [], starField;
let isGeocentric = false;
let showLabels = true, showOrbits = true, showLines = true, showZodiac = true, showStars = true;
let isPaused = false;
let timeScale = 1;
let clock = new THREE.Clock();

init();
createScene();
animate();

function init() {
  scene = new THREE.Scene(); scene.background = new THREE.Color(0x050508);
  camera = new THREE.PerspectiveCamera(50, innerWidth/innerHeight, 0.1, 5000);
  camera.position.set(260, 320, 450);
  renderer = new THREE.WebGLRenderer({antialias:true}); renderer.setSize(innerWidth, innerHeight); renderer.setPixelRatio(devicePixelRatio);
  document.getElementById('viewer').appendChild(renderer.domElement);

  labelRenderer = new THREE.CSS2DRenderer(); labelRenderer.setSize(innerWidth, innerHeight);
  labelRenderer.domElement.style.position = 'absolute'; labelRenderer.domElement.style.top = '0'; labelRenderer.domElement.style.pointerEvents = 'none';
  document.getElementById('viewer').appendChild(labelRenderer.domElement);

  controls = new THREE.OrbitControls(camera, renderer.domElement); controls.enableDamping = true; controls.dampingFactor = 0.12;
  controls.minDistance = 80; controls.maxDistance = 2200;

  scene.add(new THREE.AmbientLight(0xffffff, 1.0));
  scene.add(new THREE.PointLight(0xffffff, 4, 0).position.set(0,0,0));

  window.addEventListener('resize', () => {
    camera.aspect = innerWidth / innerHeight; camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight); labelRenderer.setSize(innerWidth, innerHeight);
  });
}

function createScene() {
  // Starfield
  const starsGeo = new THREE.BufferGeometry();
  const count = 8000;
  const pos = new Float32Array(count * 3);
  for (let i = 0; i < count * 3; i++) pos[i] = (Math.random() - 0.5) * 3200;
  starsGeo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
  starField = new THREE.Points(starsGeo, new THREE.PointsMaterial({color:0xaaaaaa, size:1.6}));
  scene.add(starField);

  // Sun
  const sun = new THREE.Mesh(new THREE.SphereGeometry(26, 64, 64), new THREE.MeshBasicMaterial({color:0xffee88}));
  scene.add(sun);

  // Planets
  planets = [];
  planetData.forEach(p => {
    if (p.radius === 0) return;
    let mat;
    if (p.tex) {
      const tex = new THREE.TextureLoader().load(p.tex);
      tex.colorSpace = THREE.SRGBColorSpace;
      mat = new THREE.MeshPhongMaterial({map: tex, emissive:0x112244, emissiveIntensity:0.3});
    } else {
      mat = new THREE.MeshPhongMaterial({color: p.color, emissive: p.color, emissiveIntensity: 0.8, shininess: 10});
    }
    const mesh = new THREE.Mesh(new THREE.SphereGeometry(p.size, 48, 48), mat);
    scene.add(mesh);

    const div = document.createElement('div');
    div.className = 'label';
    div.innerHTML = `${p.symbol} <span style="font-size:0.82em">${p.name}</span>`;
    const label = new THREE.CSS2DObject(div);
    scene.add(label);
    planets.push({mesh, label, data: p});
  });

  // Moon
  const moonTex = new THREE.TextureLoader().load("https://upload.wikimedia.org/wikipedia/commons/2/26/Solarsystemscope_texture_2k_moon.jpg");
  moon = new THREE.Mesh(new THREE.SphereGeometry(4.8, 32, 32), new THREE.MeshPhongMaterial({map: moonTex}));
  scene.add(moon);
  const moonDiv = document.createElement('div'); moonDiv.className = 'label';
  moonDiv.innerHTML = `â˜½ Moon`;
  moon.label = new THREE.CSS2DObject(moonDiv); scene.add(moon.label);

  // Orbits
  planetData.forEach(p => {
    if (p.radius === 0) return;
    const curve = new THREE.EllipseCurve(0,0,p.radius,p.radius);
    const points = curve.getPoints(100);
    const line = new THREE.Line(new THREE.BufferGeometry().setFromPoints(points), new THREE.LineBasicMaterial({color:0x334466, transparent:true, opacity:0.3}));
    const inc = (inclinations[p.name] || 0) * Math.PI/180;
    line.rotation.x = inc;
    scene.add(line);
    orbits.push(line);
  });

  // Zodiac wheel
  zodiacGroup = new THREE.Group();
  const r = 580;
  const torus = new THREE.Mesh(new THREE.TorusGeometry(r, 12, 16, 128), new THREE.MeshBasicMaterial({color:0x5577aa, transparent:true, opacity:0.55, side:THREE.DoubleSide}));
  torus.rotation.x = Math.PI/2;
  zodiacGroup.add(torus);

  for (let i = 0; i < 12; i++) {
    const ang = i * (Math.PI*2/12) - Math.PI/2;
    zodiacGroup.add(new THREE.Line(new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(0,8,0), new THREE.Vector3(r*1.05*Math.cos(ang),8,r*1.05*Math.sin(ang))]), new THREE.LineBasicMaterial({color:0x99aaff, transparent:true, opacity:0.45})));

    const div = document.createElement('div'); div.className = 'label'; div.style.textAlign = 'center'; div.style.lineHeight = '1.1';
    div.innerHTML = `<div style="font-size:15px;opacity:0.85">${signs[i].split(' ')[1]}</div><div style="font-size:38px">${signs[i].split(' ')[0]}</div>`;
    const lbl = new THREE.CSS2DObject(div);
    const rr = r * 1.17;
    lbl.position.set(rr*Math.cos(ang), 40, rr*Math.sin(ang));
    zodiacGroup.add(lbl);
  }
  scene.add(zodiacGroup);
}

function animate() {
  requestAnimationFrame(animate);
  const t = clock.getElapsedTime();
  const days = t * timeScale;

  // Calculate heliocentric positions
  let earthPos = new THREE.Vector3(0,0,0);
  planets.forEach(p => {
    if (!p.data.period) return;
    const ang = p.data.initial + 2 * Math.PI * days / p.data.period;
    const inc = (inclinations[p.data.name] || 0) * Math.PI / 180;

    let x = p.data.radius * Math.cos(ang);
    let z = p.data.radius * Math.sin(ang) * Math.cos(inc);
    let y = p.data.radius * Math.sin(ang) * Math.sin(inc);

    p.mesh.position.set(x, y, z);

    if (p.data.name === "Earth") earthPos.copy(p.mesh.position);
  });

  // Geocentric transformation: subtract Earth's position from all other bodies
  if (isGeocentric) {
    planets.forEach(p => {
      if (p.data.name !== "Earth") {
        p.mesh.position.sub(earthPos);
      }
    });
    moon.position.sub(earthPos);
  }

  // Update labels
  planets.forEach(p => {
    p.label.position.copy(p.mesh.position);
    p.label.position.y += p.data.size + 20;
    p.label.element.style.opacity = THREE.MathUtils.clamp(1.6 - camera.position.distanceTo(p.mesh.position)/1100, 0.15, 1);
  });

  // Moon around Earth
  const moonAng = days / 27.3 * 2 * Math.PI * 9;
  const mr = 32;
  moon.position.x = (isGeocentric ? 0 : earthPos.x) + mr * Math.cos(moonAng);
  moon.position.z = (isGeocentric ? 0 : earthPos.z) + mr * Math.sin(moonAng);
  moon.position.y = (isGeocentric ? 0 : earthPos.y) + Math.sin(moonAng) * 6;
  moon.label.position.copy(moon.position);
  moon.label.position.y += 14;

  zodiacGroup.rotation.y += 0.00028;

  // Sight lines from current center
  if (showLines) {
    earthLines.forEach(l => scene.remove(l)); earthLines = [];
    const center = isGeocentric ? new THREE.Vector3(0,0,0) : earthPos;
    planets.concat([{mesh: moon, data:{name:"Moon"}}]).forEach(obj => {
      if (obj.data.name === "Earth" || obj.data.name === "Sun") return;
      const line = new THREE.Line(
        new THREE.BufferGeometry().setFromPoints([obj.mesh.position, center]),
        new THREE.LineBasicMaterial({color:0xffdd88, transparent:true, opacity:0.4})
      );
      scene.add(line);
      earthLines.push(line);
    });
  }

  controls.update();
  renderer.render(scene, camera);
  labelRenderer.render(scene, camera);
}

// Toggle View Mode
document.getElementById('toggle-view').addEventListener('click', function() {
  isGeocentric = !isGeocentric;
  this.classList.toggle('heliocentric', !isGeocentric);
  this.classList.toggle('geocentric', isGeocentric);
  this.textContent = isGeocentric ? "Geocentric â€“ click to return to Heliocentric" : "Heliocentric â€“ click to switch to Geocentric";

  // Stabilize view
  controls.enableDamping = false;
  setTimeout(() => controls.enableDamping = true, 300);

  if (isGeocentric) {
    camera.position.set(0, 120, 520);
  } else {
    camera.position.set(260, 320, 450);
  }
  controls.target.set(0,0,0);
  controls.update();
});

// Other toggles
document.getElementById('toggle-labels').addEventListener('click', function() {
  showLabels = !showLabels;
  planets.forEach(p => p.label.visible = showLabels);
  moon.label.visible = showLabels;
  this.classList.toggle('on', showLabels);
  this.textContent = `Labels: ${showLabels ? 'ON' : 'OFF'}`;
});

document.getElementById('toggle-orbits').addEventListener('click', function() {
  showOrbits = !showOrbits;
  orbits.forEach(o => o.visible = showOrbits);
  this.classList.toggle('on', showOrbits);
  this.textContent = `Orbits: ${showOrbits ? 'ON' : 'OFF'}`;
});

document.getElementById('toggle-lines').addEventListener('click', function() {
  showLines = !showLines;
  this.classList.toggle('on', showLines);
  this.textContent = `Sight Lines: ${showLines ? 'ON' : 'OFF'}`;
});

document.getElementById('toggle-zodiac').addEventListener('click', function() {
  showZodiac = !showZodiac;
  zodiacGroup.visible = showZodiac;
  this.classList.toggle('on', showZodiac);
  this.textContent = `Zodiac: ${showZodiac ? 'ON' : 'OFF'}`;
});

document.getElementById('toggle-stars').addEventListener('click', function() {
  showStars = !showStars;
  starField.visible = showStars;
  this.classList.toggle('on', showStars);
  this.textContent = `Stars: ${showStars ? 'ON' : 'OFF'}`;
});

function setSpeed(v) {
  timeScale = v;
  document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('on'));
  event.target.classList.add('on');
}

function togglePause() {
  isPaused = !isPaused;
  document.getElementById('pause-btn').textContent = isPaused ? 'Resume' : 'Pause';
}

function resetView() {
  camera.position.set(isGeocentric ? 0 : 260, 320, isGeocentric ? 520 : 450);
  controls.target.set(0,0,0);
  controls.update();
}
</script>
</body>
</html>
